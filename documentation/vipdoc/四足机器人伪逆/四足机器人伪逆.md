# 四足机器人伪逆

## 普通的伪逆

没什么好说的，就是一般的伪逆，$J^{+}$

## 加权伪逆

未加权的极小范数最小二乘解：$J^{T}_{1}(J_{1} J^{T}_{1})^{-1}$

加权后的极小范数最小二乘解：$(J^{T}_{1}WJ_{1})^{-1} J^{T}_{1} W $

## 动态一致性伪逆

外力和力矩满足：
$$
\tau = J^{T}F \label{力和力矩等式}
$$
假设此时关节电机也有作用力$\tau_j$，由于外力现在已经约束在$F$了，为了保证$F$不发生变化，$\tau_i$要求：
$$
J^{-T} \tau_i = 0 \label{力矩约束}
$$
利用零空间性质，$\tau_i = (I - J^{T}J^{-T}) \tau_0$即可满足要求。

常用力平衡方程为：
$$
A\ddot q + b(q,\dot q) + g = \tau + J_{ext}^{T}F_{ext} \label{力平衡方程}
$$
按照公式$\ref{力和力矩等式}$和$\ref{力矩约束}$，得到新的力平衡公式：
$$
A\ddot q + b(q,\dot q) + g = (I - J^{T}J^{-T}) \tau_0 + J^{T}F \label{外力恒等下的力平衡方程}
$$
空间运动有：
$$
\begin{array}{rl}
\dot X &= v = J^{T} \dot q \\
\ddot X & = a = J^{T}\ddot q + \dot J^{T} \dot q
\end{array}
$$
有$\ddot q = J^{-T}(\ddot X - \dot J \dot q)$。

将上式带入到公式$\ref{外力恒等下的力平衡方程}$，则有：
$$
A J^{-T}(\ddot X - \dot J^{T} \dot q) + b(q,\dot q) + g = (I - J^{T}J^{-T}) \tau_0 + J^{T}F \\
\ddot X  - \dot J^{T} \dot q+ (AJ^{-T})^{-}(b(q,\dot q) + g) = (AJ^{-T})^{-}(I - J^{T}J^{-T})\tau_0 + (AJ^{-T})^{-}J^{T}F \\
\ddot X  - \dot J^{T} \dot q+ J^{T}A^{-}(b(q,\dot q) + g) = J^{T}A^{-}(I - J^{T}J^{-T})\tau_0 + J^{T}A^{-}J^{T}F\\
$$
令最后一项：
$$
(AJ^{-T})^{-}(I - J^{T}J^{-T})\tau_0 = 0 \\
J^{T}A^{-}(I - J^{T}J^{-T})\tau_0 = 0
\label{动态一致性}
$$
意味着电机力矩不末端产生加速度。称为动态一致性。

再进一步的，如果对于任何$\tau_0$，公式$\ref{动态一致性}$都要满足的话，可令左侧的矩阵恒为0，则有：
$$
JA^{-} = JA^{-} J^{T}J^{-T} \\
J^{-T} = (JA^{-}J^{T})^{-}JA^{-}
$$
得到了保证动态一致性下的广义逆。

同时，由于这个作用下的力矩不对外产生加速度（力），因此也是能量最低方程。