# 四足机器人算法模块

Mini Cheetah中用到了大量的算法，下面进行总结。

1. MPC算法

   MPC算法是第一层算法。传统的PID算法对于四足机器人失效（约束不够），而MPC能够基于物理模型，将机器人看成单刚体模型，根据期望状态计算足端作用力。

   由于是将机器人视为单刚体模型，当需要运行相应的动作时，会将足端作用力直接通过雅可比矩阵换算到各个关节，同时利用足端到肩膀的期望位置和速度进行补偿。

   MPC用到了几个技巧。

   1. 将12维的状态方程，拓展为13维，最后一维是重力加速度$g$，从而将状态方程的常数项隐藏。
   2. 在计算连续状态方程到离散状态方程的过程中，已经得到了连续状态方程的$A,B$矩阵，计算离散状态方程$\bar{A},\bar{B}$的时候，参考《Cheetah中MPC状态方程中存在的一些问题》。

2. WBC算法

   whole body算法，是基于整体的运动学和动力学，对控制进行优化。整体分为三层。

   1. 基于零空间的运动学计算

      由于实际运动于期望的会有差异，因此需要通过调整加速度，实现速度和位置都满足期望。由于采用的是浮动基模型，共有18个自由度，前6项是本体6自由度，后12项是关节自由度。

   2. 基于力平衡方程的接触力优化
   
      由于本体的6个自由度的加速度得到了优化，此时在使用MPC计算的足端作用力是没法达到的。而力平衡方程对本体加速度和足端作用力进行了约束，找到合适的优化值。
   
   3. 关节力矩计算
   
      针对本体自由度的加速度优化之后，足端作用已经确定，此时可以做关节力矩的计算。直接代入即可。
