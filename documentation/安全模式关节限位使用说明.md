# 关节限位函数位置：

Cheetah/user/BZL_Controller/FSM_States/ControlFSM.cpp

void ControlFSM<T>::JointPosCheck(FSM_StateName stateName)

# 使用说明：

主要的限位包括5个参数：

```c++
  Eigen::Matrix<float,3,1> qd_damp_limit_max;

  Eigen::Matrix<float,3,1> q_damp_limit_max;
  Eigen::Matrix<float,3,1> q_damp_limit_min;
  Eigen::Matrix<float,3,1> q_soft_limit_max;
  Eigen::Matrix<float,3,1> q_soft_limit_min;
```

## 参数用法：

关节速度绝对值超过qd_damp_limit_max时进入高阻尼模式；

关节角度超过q_damp_limit_max或q_damp_limit_min时进入高阻尼模式；

关节指令/真实关节值超过q_soft_limit_max或q_soft_limit_min时，将指令限制在限位范围内，当前的运动不会被停止；

## 参数赋值：

根据使用的版本不同，分别进行关节限位：

```C++
#if (USE_LINKAGE_INDUSTRIAL == 1)
  ......
#endif
#if (USE_LINKAGE == 1) 
  ......
#endif
```

根据不同状态机的具体需求，具体增加case和限位（添加方法参考LOCOMOTION），q_damp_limit的限位范围要比q_soft_limit的限位范围更宽,赋值顺序为abad、hip和knee。

default为默认情况下的限位，一般赋给比机械限位略小的值。

```C++
switch (stateName)
  {
  case FSM_StateName::LOCOMOTION://
    q_damp_limit_max << 0.6, 0.6, 2.7;   //abad,hip,knee
    q_damp_limit_min << -0.6, -1.8, 0.6; 
    q_soft_limit_max << 0.5, 0.4, 2.7;  
    q_soft_limit_min << -0.5, -1.65, 0.7;
    isLocomotion = true;
    break;

  default:
     q_damp_limit_max << 1.5, 3.14, 2.85;  // 2.7;
     q_damp_limit_min << -1.5, -3.14, 0.5; // 0.8;
     q_soft_limit_max << 1.2, 3.1, 2.8;    // 2.7;
     q_soft_limit_min << -1.2, -3.1, 0.6;  // 0.6;
     break;
}
    qd_damp_limit_max << 20, 40, 40;
```

